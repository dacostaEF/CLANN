__d(function(g,r,i,a,m,e,d){var n=r(d[0]);Object.defineProperty(e,"__esModule",{value:!0}),e.EnforcementResult=e.ACTION_TYPES=void 0,e.checkAction=_,e.enforceAndExecute=function(n,t,o,u){return y.apply(this,arguments)},e.getRelevantRules=function(n,t){return b.apply(this,arguments)},e.hasPermission=function(n,t,o,u){return I.apply(this,arguments)};var t=n(r(d[1])),o=n(r(d[2])),u=n(r(d[3])),l=n(r(d[4])),s=n(r(d[5])),c=r(d[6]),f=r(d[7]),E=r(d[8]),v=(n(r(d[9])),e.ACTION_TYPES={SEND_MESSAGE:'send_message',EDIT_MESSAGE:'edit_message',DELETE_MESSAGE:'delete_message',JOIN_CLAN:'join_clan',LEAVE_CLAN:'leave_clan',INVITE_MEMBER:'invite_member',REMOVE_MEMBER:'remove_member',PROMOTE_MEMBER:'promote_member',CREATE_RULE:'create_rule',EDIT_RULE:'edit_rule',DELETE_RULE:'delete_rule',ADD_ELDER:'add_elder',REMOVE_ELDER:'remove_elder',CHANGE_SETTINGS:'change_settings',CHANGE_PRIVACY:'change_privacy',UPLOAD_FILE:'upload_file',CREATE_EVENT:'create_event',CREATE_POLL:'create_poll'}),p=e.EnforcementResult=(function(){function n(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,l.default)(this,n),this.allowed=t,this.reason=o,this.violatedRules=u}return(0,s.default)(n,null,[{key:"allow",value:function(){return new n(!0)}},{key:"deny",value:function(t){return new n(!1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[])}}])})();function _(n,t){return h.apply(this,arguments)}function h(){return h=(0,u.default)(function*(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{var u=yield(0,c.getActiveRules)(n);if(!u||0===u.length)return p.allow();var l=[],s=o.userTotem;o.userRole,o.targetTotem,o.targetRole,o.data;for(var E of u){var v=yield R(E,t,o);v&&l.push({ruleId:E.rule_id,ruleText:E.text,violation:v})}if(l.length>0){var _=`A\xe7\xe3o bloqueada por ${l.length} regra(s) ativa(s)`;return yield(0,f.logSecurityEvent)(f.SECURITY_EVENTS.CLAN_UPDATED,{type:'rule_violation',clanId:n,actionType:t,violatedRules:l.map(function(n){return n.ruleId}),userTotem:s,context:o},s),p.deny(_,l)}return p.allow()}catch(n){return console.error('Erro ao verificar enforcement:',n),p.allow()}}),h.apply(this,arguments)}function R(n,t,o){return A.apply(this,arguments)}function A(){return(A=(0,u.default)(function*(n,t,o){var u=n.text.toLowerCase(),l=o.userTotem,s=o.userRole,c=o.targetTotem,f=(o.targetRole,o.data);if(t===v.SEND_MESSAGE){if(u.includes('proibido enviar mensagem')||u.includes('n\xe3o pode enviar mensagem')||u.includes('bloqueado enviar'))return'Envio de mensagens est\xe1 bloqueado por regra ativa';if(u.includes('hor\xe1rio')||u.includes('horario')){var p=(new Date).getHours(),_=u.match(/(\d+)h.*(\d+)h/);if(_){var h=parseInt(_[1]),R=parseInt(_[2]);if(p<h||p>R)return`Mensagens permitidas apenas entre ${h}h e ${R}h`}}if(null!=f&&f.messageText){var A=f.messageText.toLowerCase();if(u.includes('palavras proibidas')||u.includes('proibido usar')){var y=T(u);for(var b of y)if(A.includes(b.toLowerCase()))return`Palavra proibida detectada: "${b}"`}}}if(t===v.REMOVE_MEMBER){if(u.includes('proibido remover membro')||u.includes('n\xe3o pode remover')||u.includes('prote\xe7\xe3o de membros'))return'Remo\xe7\xe3o de membros est\xe1 bloqueada por regra ativa';if(c)if((yield(0,E.isElder)(o.clanId,c))&&u.includes('prote\xe7\xe3o anci\xf5es'))return'Anci\xf5es est\xe3o protegidos contra remo\xe7\xe3o'}if(t===v.CREATE_RULE&&((u.includes('apenas anci\xf5es podem criar regras')||u.includes('somente anci\xf5es criam regras'))&&!(yield(0,E.isElder)(o.clanId,l))&&'founder'!==s))return'Apenas anci\xf5es podem criar regras';if((t===v.CHANGE_SETTINGS||t===v.CHANGE_PRIVACY)&&(u.includes('configura\xe7\xf5es bloqueadas')||u.includes('n\xe3o pode alterar configura\xe7\xf5es'))&&'founder'!==s)return'Altera\xe7\xe3o de configura\xe7\xf5es est\xe1 bloqueada';if(t===v.UPLOAD_FILE){if(u.includes('proibido upload')||u.includes('n\xe3o pode enviar arquivo'))return'Upload de arquivos est\xe1 bloqueado';if(null!=f&&f.fileSize&&u.includes('tamanho m\xe1ximo')){var I=u.match(/(\d+)\s*(mb|kb|gb)/i);if(I){var L,S=parseInt(I[1]),C=I[2].toLowerCase();if('gb'===C?L=1024*S*1024*1024:'mb'===C?L=1024*S*1024:'kb'===C&&(L=1024*S),f.fileSize>L)return`Arquivo excede tamanho m\xe1ximo permitido (${S}${C})`}}}if(u.includes('apenas')||u.includes('somente')){if(u.includes('fundador')&&'founder'!==s)return'A\xe7\xe3o restrita ao fundador';if(u.includes('admin')&&'admin'!==s&&'founder'!==s)return'A\xe7\xe3o restrita a administradores';if(u.includes('anci\xe3o')||u.includes('elder'))if(!(yield(0,E.isElder)(o.clanId,l))&&'founder'!==s)return'A\xe7\xe3o restrita a anci\xf5es'}return u.includes('limite')||u.includes('m\xe1ximo'),null})).apply(this,arguments)}function T(n){var t=[];for(var u of[/palavras?\s*(proibidas?|bloqueadas?):\s*([^\.]+)/i,/proibido\s*(usar|dizer|escrever):\s*([^\.]+)/i,/n\xe3o\s*(pode|pode-se)\s*(usar|dizer|escrever):\s*([^\.]+)/i]){var l=n.match(u);if(l){var s=l[l.length-1];t.push.apply(t,(0,o.default)(s.split(/[,;]/).map(function(n){return n.trim()}).filter(function(n){return n})))}}return t}function y(){return(y=(0,u.default)(function*(n,t,o,u){var l=yield _(n,t,o);if(!l.allowed){var s=new Error(l.reason);throw s.violatedRules=l.violatedRules,s.enforcementBlocked=!0,s}return yield u()})).apply(this,arguments)}function b(){return(b=(0,u.default)(function*(n,o){var u=yield(0,c.getActiveRules)(n),l=(0,t.default)((0,t.default)((0,t.default)((0,t.default)((0,t.default)({},v.SEND_MESSAGE,['mensagem','enviar','chat','comunica\xe7\xe3o']),v.REMOVE_MEMBER,['membro','remover','expulsar','remover']),v.CREATE_RULE,['regra','criar','governan\xe7a']),v.UPLOAD_FILE,['arquivo','upload','enviar arquivo']),v.CHANGE_SETTINGS,['configura\xe7\xe3o','settings','alterar'])[o]||[];return u.filter(function(n){var t=n.text.toLowerCase();return l.some(function(n){return t.includes(n)})})})).apply(this,arguments)}function I(){return(I=(0,u.default)(function*(n,t,o,u){var l={userTotem:t,userRole:o,clanId:n};return(yield _(n,u,l)).allowed})).apply(this,arguments)}},717,[1,11,32,226,5,6,686,406,690,404]);